Title: TGCS Simulation Discussion


This page contains additional content for the simulation discussion session on TGCS 2021: **Simulation of walking with added mass to validate predictive simulations of human walking**. You can download the slides from my presentation here: <https://kuleuven-my.sharepoint.com/:b:/g/personal/u0088756_kuleuven_be/EVGjjj8d4LFBj-UUAyE9LoIBxWPhw86XkEO5xBQ5g7gW2g?e=iOpuQp> if this is helpfull for the discussion session.


## Simulation discussion: open questions




<img src="/images/Q1_TGCS_Disc.svg"
     alt="First question simulation discussion"
     style="float: left; margin-right: 10px;" />

<img src="/images/Q2_TGCS_Disc.svg"
     alt="First question simulation discussion"
     style="float: left; margin-right: 10px;" />


## Overview optimization problem

The predictive simulations are based on Falisse 2019 (<https://doi.org/10.1098/rsif.2019.0402>) with matlab implementation (<https://github.com/antoinefalisse/3dpredictsim>). The musculoskeletal model is based on Hamner (<https://simtk-confluence.stanford.edu/display/OpenSim/Full+Body+Running+Model>) and is implemented in opensim (<https://simtk.org/projects/opensim>).

states:

 - muscle activations
 - muscle force
 - joint angles
 - angular velocties


controls:

- time derivative muscle activation
- time derivative muscle force
- joint accelerations

static optimization variables:

- final simulation time

cost function:

- excitations squared
- Activation squared
- Metabolic energy computed with a smooth version of Bhargava 2004
- Joint accelerations
- Passive forces (i.e. coordinate limit forces that generate a torque at extreme joint angles. These forces respresent ligaments)
- Torque actuators (torques generated by ideal actuators at joint that are not spanned by muscles: shoulder and elbow)
- (Slack controls for time derivative of normalized muscle force)
- (Slack controls for implicit activation dynamics)

dynamic constraints:

- activation dynamics
- contraction dynamics
- skeleton dynamics

path constraints:

- Average walking speed
- Symmetric walking motion (we simulate half a gait cycle)
- Kinematic constraint to prevent penetration left and right leg during midswing.

We used matlab to create NLP with the casadi API <https://web.casadi.org/> and solved the problem with IPOPT.


## Simulations with added mass

We simulated the experiments of two papers that evaluated the effect of added mass on the kinematics and energetics of human movemement.

1. The effects of adding mass to the legs on the energetics and biomechanics of walking (<https://doi.org/10.1249/mss.0b013e31802b3562>)
2. Metabolic rate of carrying added mass: a function of walking speed, carried mass and mass location (<https://doi.org/10.1016/j.apergo.2014.04.009>)

### Reference walking simulations


Animation of simulated walking pattern without added mass (Reference walking). 

<video src="{static}/images/Reference.mp4" height="500" controls>
Your browser does not support the video tag.</video>

<video src="{static}/images/Reference_frontal.mp4" height="500" controls>
Your browser does not support the video tag.</video>

This figures gives a detailed comparison between motion capture data (inverse analysis) and the predictive simulations without added mass:


Joint kinematics:
<img src="/images/Kinematics_Ref.svg"
     alt="First question simulation discussion"
     style="float: left; margin-right: 10px;" />

Joint kinetics:
<img src="/images/Kinetics_Ref.svg"
     alt="First question simulation discussion"
     style="max-width:100%;" />





ADD FIGURE HERE

### Comparsion influence added mass

Comparison of simulations with added mass:

- black: Reference walking

- blue: 4kg added to each foot

- green: 4kg added to each tibia

- red: 4kg added to each femur

- gray: 16kg added to the pelvis


<video src="{static}/images/AddedMass_Sagital.mp4" height="500" controls>
Your browser does not support the video tag.</video>

<video src="{static}/images/AddedMass_Frontal2.mp4" height="500" controls>
Your browser does not support the video tag.</video>


### Added mass to the foot

4kg added to each foot:

<video src="{static}/images/Foot4.mp4" height="500" controls>
Your browser does not support the video tag.</video>

<video src="{static}/images/Foot4_Front.mp4" height="500" controls>
Your browser does not support the video tag.</video>


### Added mass to Tibia

4kg added to each tibia (as in Browning 2008):

<video src="{static}/images/Tibia4.mp4" height="500" controls>
Your browser does not support the video tag.</video>

<video src="{static}/images/Tibia4_front.mp4" height="500" controls>
Your browser does not support the video tag.</video>


### Added mass to Femur

4kg added to each femur 

<video src="{static}/images/Femur4.mp4" height="500" controls>
Your browser does not support the video tag.</video>

<video src="{static}/images/Femur4_Front.mp4" height="500" controls>
Your browser does not support the video tag.</video>


### Added mass to Pelvis

16kg added to the pelvis

<video src="{static}/images/Pelvis16.mp4" height="500" controls>
Your browser does not support the video tag.</video>

<video src="{static}/images/Pelvis16_Front.mp4" height="500" controls>
Your browser does not support the video tag.</video>


### Added mass to Ankle: walking speed


2kg kg added to each ankle, walking at 4km/h

<video src="{static}/images/Ankle2_4kmh.mp4" height="500" controls>
Your browser does not support the video tag.</video>

2kg kg added to each ankle, walking at 5km/h

<video src="{static}/images/Ankle2_5kmh.mp4" height="500" controls>
Your browser does not support the video tag.</video>


2kg kg added to each ankle, walking at 6km/h
<video src="{static}/images/Ankle2_6kmh.mp4" height="500" controls>
Your browser does not support the video tag.</video>

### detailed figures effect added mass

Joint kinematics:
<img src="/images/Kinematics_Browning.svg"
     alt="First question simulation discussion"
     style="float: left; margin-right: 10px;" />

Joint kinetics:
<img src="/images/Kinetics_Browning.svg"
     alt="First question simulation discussion"
     style="max-width:100%;" />


### My thoughts on simplications in modelling 

My current simulations approach can predict the effect of added mass on metabolic energy consumption reasonable well, but fails the predict the effect on metabolic energy consumption. My current list on the most important modelling simplifications (and how we could test them). Anyone other idea's ?

Modelling control:

- (Robust) feedback control is needed to simulate some important features in walking, such as the co-activation of the vasti and the biceps femoris before heelcontact (assumed to stiffen the knee and provide stability before the uncertain interaction with the ground).
- We have the objective function wrong.

Modelling musculoskeletal dynamics:

- Errors in simulating ankle kinematic have a large influence on muscle states and metabolic energy consumption. Use an invers skeleton dynamics approach and solve the muscle redundancy problem to evaluate if the errors in kinematics can explain the error in predicted muscle states and metabolic energy consumption.


Computing metabolic energy:

- Current energy models (Bhargava, Umberger) predict very high muscle efficiencies. We predict more realistic incraeses in metabolic energy with added mass when using a model with 25% efficiency for positive work and 120% efficiency for negative work (but this model largely overstimates the COT during normal walking without added mass).

Experiment:

- Subjects are not fully adapated to walking with added mass (7-10 minutes adaptation in experiment) and therefore have a higher metabolic cost compared to simulations.

### My thoughts on other benchmark tests to evaluate predictive validity (of walking simulations)

mechanical interventions:

- Walking with added mass
- walking at various speeds
- imposing stride frequency
- ....

outcomes:

- Kinematics (motion capture)
- Ground reaction forces (force plate)
- mucle activity (EMG)
- metabolic energy consumption (O2, CO2)
- muscle fiber kinematics (ultrasound)